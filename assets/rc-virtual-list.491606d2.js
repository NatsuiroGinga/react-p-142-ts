import{a as O,d as q,g as Ye,h as Oe,i as pe,j as ge,c as _,_ as me,b as je}from "./@babel.3781e41b.js";import{r as f}from "./react.aaec2051.js";import{c as G}from "./classnames.4fb4381a.js";import{R as ze}from "./rc-resize-observer.c7f31fe7.js";import{j as y,b as We}from "./@ant-design.023abccc.js";import{b as H,q as Ke,g as ne}from "./rc-util.5fc3e0fc.js";var Re=f.exports.forwardRef(function(r, v){var a=r.height,e=r.offset,c=r.children,o=r.prefixCls,u=r.onInnerResize,t={},n={display:"flex",flexDirection:"column"};return e!==void 0&&(t={height:a,position:"relative",overflow:"hidden"},n=O(O({},n),{},{transform:"translateY(".concat(e,"px)"),position:"absolute",left:0,right:0,top:0})),y("div",{style:t,children:y(ze,{onResize:function(s){var l=s.offsetHeight;l&&u&&u()},children:y("div",{style:n,className:G(q({},"".concat(o,"-holder-inner"),o)),ref:v,children:c})})})});Re.displayName="Filler";var Ve=20;function de(r){return"touches"in r?r.touches[0].pageY:r.pageY}var Ae=function(r){Ye(a,r);var v=Oe(a);function a(){var e;pe(this,a);for(var c=arguments.length,o=new Array(c),u=0; u<c; u++)o[u]=arguments[u];return e=v.call.apply(v,[this].concat(o)),e.moveRaf=null,e.scrollbarRef=f.exports.createRef(),e.thumbRef=f.exports.createRef(),e.visibleTimeout=null,e.state={dragging:!1,pageY:null,startTop:null,visible:!1},e.delayHidden=function(){clearTimeout(e.visibleTimeout),e.setState({visible:!0}),e.visibleTimeout=setTimeout(function(){e.setState({visible:!1})},2e3)},e.onScrollbarTouchStart=function(t){t.preventDefault()},e.onContainerMouseDown=function(t){t.stopPropagation(),t.preventDefault()},e.patchEvents=function(){window.addEventListener("mousemove",e.onMouseMove),window.addEventListener("mouseup",e.onMouseUp),e.thumbRef.current.addEventListener("touchmove",e.onMouseMove),e.thumbRef.current.addEventListener("touchend",e.onMouseUp)},e.removeEvents=function(){var t;window.removeEventListener("mousemove",e.onMouseMove),window.removeEventListener("mouseup",e.onMouseUp),(t=e.scrollbarRef.current)===null||t===void 0||t.removeEventListener("touchstart",e.onScrollbarTouchStart),e.thumbRef.current&&(e.thumbRef.current.removeEventListener("touchstart",e.onMouseDown),e.thumbRef.current.removeEventListener("touchmove",e.onMouseMove),e.thumbRef.current.removeEventListener("touchend",e.onMouseUp)),H.cancel(e.moveRaf)},e.onMouseDown=function(t){var n=e.props.onStartMove;e.setState({dragging:!0,pageY:de(t),startTop:e.getTop()}),n(),e.patchEvents(),t.stopPropagation(),t.preventDefault()},e.onMouseMove=function(t){var n=e.state,i=n.dragging,s=n.pageY,l=n.startTop,d=e.props.onScroll;if(H.cancel(e.moveRaf),i){var p=de(t)-s,m=l+p,S=e.getEnableScrollRange(),M=e.getEnableHeightRange(),D=M?m/M:0,L=Math.ceil(D*S);e.moveRaf=H(function(){d(L)})}},e.onMouseUp=function(){var t=e.props.onStopMove;e.setState({dragging:!1}),t(),e.removeEvents()},e.getSpinHeight=function(){var t=e.props,n=t.height,i=t.count,s=n/i*10;return s=Math.max(s,Ve),s=Math.min(s,n/2),Math.floor(s)},e.getEnableScrollRange=function(){var t=e.props,n=t.scrollHeight,i=t.height;return n-i||0},e.getEnableHeightRange=function(){var t=e.props.height,n=e.getSpinHeight();return t-n||0},e.getTop=function(){var t=e.props.scrollTop,n=e.getEnableScrollRange(),i=e.getEnableHeightRange();if(t===0||n===0)return 0;var s=t/n;return s*i},e.showScroll=function(){var t=e.props,n=t.height,i=t.scrollHeight;return i>n},e}return ge(a,[{key:"componentDidMount",value:function(){this.scrollbarRef.current.addEventListener("touchstart",this.onScrollbarTouchStart),this.thumbRef.current.addEventListener("touchstart",this.onMouseDown)}},{key:"componentDidUpdate",value:function(c){c.scrollTop!==this.props.scrollTop&&this.delayHidden()}},{key:"componentWillUnmount",value:function(){this.removeEvents(),clearTimeout(this.visibleTimeout)}},{key:"render",value:function(){var c=this.state,o=c.dragging,u=c.visible,t=this.props.prefixCls,n=this.getSpinHeight(),i=this.getTop(),s=this.showScroll(),l=s&&u;return y("div",{ref:this.scrollbarRef,className:G("".concat(t,"-scrollbar"),q({},"".concat(t,"-scrollbar-show"),s)),style:{width:8,top:0,bottom:0,right:0,position:"absolute",display:l?null:"none"},onMouseDown:this.onContainerMouseDown,onMouseMove:this.delayHidden,children:y("div",{ref:this.thumbRef,className:G("".concat(t,"-scrollbar-thumb"),q({},"".concat(t,"-scrollbar-thumb-moving"),o)),style:{width:"100%",height:n,top:i,left:0,position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"},onMouseDown:this.onMouseDown})})}}]),a}(f.exports.Component);function qe(r){var v=r.children,a=r.setRef,e=f.exports.useCallback(function(c){a(c)},[]);return f.exports.cloneElement(v,{ref:e})}function Ge(r, v, a, e, c, o){var u=o.getKey;return r.slice(v,a+1).map(function(t, n){var i=v+n,s=c(t,i,{}),l=u(t);return y(qe,{setRef:function(p){return e(t,p)},children:s},l)})}var Ze=function(){function r(){pe(this,r),this.maps=void 0,this.maps=Object.create(null)}return ge(r,[{key:"set",value:function(a, e){this.maps[a]=e}},{key:"get",value:function(a){return this.maps[a]}}]),r}();function Be(r, v, a){var e=f.exports.useState(0),c=_(e,2),o=c[0],u=c[1],t=f.exports.useRef(new Map),n=f.exports.useRef(new Ze),i=f.exports.useRef();function s(){H.cancel(i.current)}function l(){s(),i.current=H(function(){t.current.forEach(function(p, m){if(p&&p.offsetParent){var S=Ke(p),M=S.offsetHeight;n.current.get(m)!==M&&n.current.set(m,S.offsetHeight)}}),u(function(p){return p+1})})}function d(p, m){var S=r(p),M=t.current.get(S);m?(t.current.set(S,m),l()):t.current.delete(S),!M!=!m&&(m?v==null||v(p):a==null||a(p))}return f.exports.useEffect(function(){return s},[]),[d,l,n.current,o]}function Je(r, v, a, e, c, o, u, t){var n=f.exports.useRef();return function(i){if(i==null){t();return}if(H.cancel(n.current),typeof i=="number")u(i);else if(i&&me(i)==="object"){var s,l=i.align;"index"in i?s=i.index:s=v.findIndex(function(S){return c(S)===i.key});var d=i.offset,p=d===void 0?0:d,m=function S(M, D){if(!(M<0||!r.current)){var L=r.current.clientHeight,b=!1,k=D;if(L){for(var Z=D||l,P=0,E=0,N=0,B=Math.min(v.length,s),C=0; C<=B; C+=1){var J=c(v[C]);E=P;var $=a.get(J);N=E+($===void 0?e:$),P=N,C===s&&$===void 0&&(b=!0)}var I=null;switch(Z){case"top":I=E-p;break;case"bottom":I=N-L+p;break;default:{var R=r.current.scrollTop,x=R+L;E<R?k="top":N>x&&(k="bottom")}}I!==null&&I!==r.current.scrollTop&&u(I)}n.current=H(function(){b&&o(),S(M-1,k)})}};m(3)}}}function Qe(r, v, a){var e=r.length,c=v.length,o,u;if(e===0&&c===0)return null;e<c?(o=r,u=v):(o=v,u=r);var t={__EMPTY_ITEM__:!0};function n(m){return m!==void 0?a(m):t}for(var i=null,s=Math.abs(e-c)!==1,l=0; l<u.length; l+=1){var d=n(o[l]),p=n(u[l]);if(d!==p){i=l,s=s||d!==n(u[l+1]);break}}return i===null?null:{index:i,multiple:s}}function Xe(r, v, a){var e=f.exports.useState(r),c=_(e,2),o=c[0],u=c[1],t=f.exports.useState(null),n=_(t,2),i=n[0],s=n[1];return f.exports.useEffect(function(){var l=Qe(o||[],r||[],v);(l==null?void 0:l.index)!==void 0&&(a==null||a(l.index),s(r[l.index])),u(r)},[r]),[i]}var et=(typeof navigator>"u"?"undefined":me(navigator))==="object"&&/Firefox/i.test(navigator.userAgent);const Se=function(r, v){var a=f.exports.useRef(!1),e=f.exports.useRef(null);function c(){clearTimeout(e.current),a.current=!0,e.current=setTimeout(function(){a.current=!1},50)}var o=f.exports.useRef({top:r,bottom:v});return o.current.top=r,o.current.bottom=v,function(u){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=u<0&&o.current.top||u>0&&o.current.bottom;return t&&n?(clearTimeout(e.current),a.current=!1):(!n||a.current)&&c(),!a.current&&n}};function tt(r, v, a, e){var c=f.exports.useRef(0),o=f.exports.useRef(null),u=f.exports.useRef(null),t=f.exports.useRef(!1),n=Se(v,a);function i(l){if(!!r){H.cancel(o.current);var d=l.deltaY;c.current+=d,u.current=d,!n(d)&&(et||l.preventDefault(),o.current=H(function(){var p=t.current?10:1;e(c.current*p),c.current=0}))}}function s(l){!r||(t.current=l.detail===u.current)}return[i,s]}var rt=14/15;function nt(r, v, a){var e=f.exports.useRef(!1),c=f.exports.useRef(0),o=f.exports.useRef(null),u=f.exports.useRef(null),t,n=function(d){if(e.current){var p=Math.ceil(d.touches[0].pageY),m=c.current-p;c.current=p,a(m)&&d.preventDefault(),clearInterval(u.current),u.current=setInterval(function(){m*=rt,(!a(m,!0)||Math.abs(m)<=.1)&&clearInterval(u.current)},16)}},i=function(){e.current=!1,t()},s=function(d){t(),d.touches.length===1&&!e.current&&(e.current=!0,c.current=Math.ceil(d.touches[0].pageY),o.current=d.target,o.current.addEventListener("touchmove",n),o.current.addEventListener("touchend",i))};t=function(){o.current&&(o.current.removeEventListener("touchmove",n),o.current.removeEventListener("touchend",i))},ne(function(){return r&&v.current.addEventListener("touchstart",s),function(){var l;(l=v.current)===null||l===void 0||l.removeEventListener("touchstart",s),t(),clearInterval(u.current)}},[r])}var ot=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","component","onScroll","onVisibleChange"],it=[],at={overflowY:"auto",overflowAnchor:"none"};function ut(r, v){var a=r.prefixCls,e=a===void 0?"rc-virtual-list":a,c=r.className,o=r.height,u=r.itemHeight,t=r.fullHeight,n=t===void 0?!0:t,i=r.style,s=r.data,l=r.children,d=r.itemKey,p=r.virtual,m=r.component,S=m===void 0?"div":m,M=r.onScroll,D=r.onVisibleChange,L=je(r,ot),b=!!(p!==!1&&o&&u),k=b&&s&&u*s.length>o,Z=f.exports.useState(0),P=_(Z,2),E=P[0],N=P[1],B=f.exports.useState(!1),C=_(B,2),J=C[0],$=C[1],I=G(e,c),R=s||it,x=f.exports.useRef(),oe=f.exports.useRef(),ie=f.exports.useRef(),U=f.exports.useCallback(function(h){return typeof d=="function"?d(h):h==null?void 0:h[d]},[d]),Me={getKey:U};function j(h){N(function(g){var T;typeof h=="function"?T=h(g):T=h;var F=De(T);return x.current.scrollTop=F,F})}var ae=f.exports.useRef({start:0,end:R.length}),xe=f.exports.useRef(),be=Xe(R,U),Ee=_(be,1),Te=Ee[0];xe.current=Te;var ye=Be(U,null,null),z=_(ye,4),He=z[0],ue=z[1],le=z[2],we=z[3],W=f.exports.useMemo(function(){if(!b)return{scrollHeight:void 0,start:0,end:R.length-1,offset:void 0};if(!k){var h;return{scrollHeight:((h=oe.current)===null||h===void 0?void 0:h.offsetHeight)||0,start:0,end:R.length-1,offset:void 0}}for(var g=0,T,F,w,Fe=R.length,Y=0; Y<Fe; Y+=1){var Pe=R[Y],Ue=U(Pe),he=le.get(Ue),re=g+(he===void 0?u:he);re>=E&&T===void 0&&(T=Y,F=g),re>E+o&&w===void 0&&(w=Y),g=re}return T===void 0&&(T=0,F=0,w=Math.ceil(o/u)),w===void 0&&(w=R.length-1),w=Math.min(w+1,R.length),{scrollHeight:g,start:T,end:w,offset:F}},[k,b,E,R,we,o]),Q=W.scrollHeight,K=W.start,V=W.end,_e=W.offset;ae.current.start=K,ae.current.end=V;var X=Q-o,ee=f.exports.useRef(X);ee.current=X;function De(h){var g=h;return Number.isNaN(ee.current)||(g=Math.min(g,ee.current)),g=Math.max(g,0),g}var se=E<=0,ce=E>=X,Le=Se(se,ce);function Ce(h){var g=h;j(g)}function Ie(h){var g=h.currentTarget.scrollTop;g!==E&&j(g),M==null||M(h)}var ke=tt(b,se,ce,function(h){j(function(g){var T=g+h;return T})}),fe=_(ke,2),te=fe[0],ve=fe[1];nt(b,x,function(h, g){return Le(h,g)?!1:(te({preventDefault:function(){},deltaY:h}),!0)}),ne(function(){function h(g){b&&g.preventDefault()}return x.current.addEventListener("wheel",te),x.current.addEventListener("DOMMouseScroll",ve),x.current.addEventListener("MozMousePixelScroll",h),function(){x.current&&(x.current.removeEventListener("wheel",te),x.current.removeEventListener("DOMMouseScroll",ve),x.current.removeEventListener("MozMousePixelScroll",h))}},[b]);var Ne=Je(x,R,le,u,U,ue,j,function(){var h;(h=ie.current)===null||h===void 0||h.delayHidden()});f.exports.useImperativeHandle(v,function(){return{scrollTo:Ne}}),ne(function(){if(D){var h=R.slice(K,V+1);D(h,R)}},[K,V,R]);var $e=Ge(R,K,V,He,l,Me),A=null;return o&&(A=O(q({},n?"height":"maxHeight",o),at),b&&(A.overflowY="hidden",J&&(A.pointerEvents="none"))),We("div",{style:O(O({},i),{},{position:"relative"}),className:I,...L,children:[y(S,{className:"".concat(e,"-holder"),style:A,ref:x,onScroll:Ie,children:y(Re,{prefixCls:e,height:Q,offset:_e,onInnerResize:ue,ref:oe,children:$e})}),b&&y(Ae,{ref:ie,prefixCls:e,scrollTop:E,height:o,scrollHeight:Q,count:R.length,onScroll:Ce,onStartMove:function(){$(!0)},onStopMove:function(){$(!1)}})]})}var lt=f.exports.forwardRef(ut);lt.displayName="List";export{lt as L};
